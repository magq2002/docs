---
title: "Support Module API Documentation"
description: "Comprehensive API documentation for the Support Module including Assignments, Collaborators, Dashboard, Goals, Headcount, Mechanic, and Reports controllers"
---

# Support Module API

The Support Module provides comprehensive functionality for managing organizational assignments, collaborator information, performance dashboards, goal tracking, headcount management, incentive mechanics, and reporting capabilities.

## Base URL

```
https://your-domain.com/api/v2/support
```

## Authentication

All endpoints require Bearer token authentication:

```bash
Authorization: Bearer YOUR_API_TOKEN
```

<Warning>
Ensure your API token has the appropriate permissions for the Support module before making requests.
</Warning>

---

# Assignments Controller

## Upload Assignment Layout

Upload and process assignment layout files to update organizational structure.

<RequestExample>
```bash cURL
curl -X POST '/api/v2/support/assignments/upload' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  -H 'Content-Type: multipart/form-data' \
  -F 'file=@assignment_layout.xlsx'
```
</RequestExample>

<ParamField body="file" type="file" required>
Excel file (.xlsx) containing assignment layout data with required columns: employee_number, drv, uen, area, position
</ParamField>

<ResponseExample>
```json Success
{
  "success": true,
  "message": "Layout de asignaciones procesado exitosamente",
  "processing_summary": {
    "total_rows": 1250,
    "processed_rows": 1248,
    "failed_rows": 2,
    "updated_assignments": 856,
    "new_assignments": 392
  },
  "failed_records": [
    {
      "row": 15,
      "employee_number": "EMP999999",
      "error": "Empleado no encontrado en el sistema"
    },
    {
      "row": 23,
      "employee_number": "EMP888888",
      "error": "DRV inválido: debe seguir formato DRV_XXXXX"
    }
  ]
}
```
</ResponseExample>

<ResponseExample>
```json Error - File Validation
{
  "success": false,
  "error": "LayoutValidationException",
  "message": "El archivo de layout no cumple con la estructura requerida",
  "validation_errors": [
    {
      "sheet": "Assignments",
      "issue": "missing_required_columns",
      "missing_columns": ["employee_number", "drv", "uen"],
      "found_columns": ["nombre", "area", "posicion"]
    }
  ]
}
```
</ResponseExample>

<Info>
The assignment layout file must contain specific columns in the correct format. The system will validate the structure before processing.
</Info>

<Warning>
Large files may take several minutes to process. Ensure stable connection during upload.
</Warning>

---

# Collaborators Controller

## Get Collaborator Details

Retrieve comprehensive information about a specific collaborator including goals, performance metrics, and rewards.

<RequestExample>
```bash cURL
curl -X GET '/api/v2/support/collaborators/one?employee_number=EMP123456' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  -H 'Content-Type: application/json'
```
</RequestExample>

<ParamField query="employee_number" type="string" required>
Unique employee identifier in the system
</ParamField>

<ResponseExample>
```json Success
{
  "success": true,
  "collaborator": {
    "employee_number": "EMP123456",
    "full_name": "Juan Carlos Pérez",
    "position": "Ejecutivo de Ventas Senior",
    "area": "Ventas Corporativas",
    "drv": "DRV_NORTE_01",
    "uen": "UEN Norte 1",
    "hire_date": "2022-03-15",
    "status": "active"
  },
  "goals": [
    {
      "id": 1001,
      "kpi_name": "Ventas Mensuales",
      "target_amount": 150000,
      "current_amount": 142500,
      "achievement_percentage": 95.0,
      "period": "2024-12",
      "status": "in_progress"
    },
    {
      "id": 1002,
      "kpi_name": "Satisfacción Cliente",
      "target_amount": 4.5,
      "current_amount": 4.7,
      "achievement_percentage": 104.4,
      "period": "2024-12",
      "status": "achieved"
    }
  ],
  "boosters": [
    {
      "id": 501,
      "name": "Booster Ventas Q4",
      "multiplier": 1.2,
      "status": "active",
      "valid_until": "2024-12-31"
    }
  ],
  "points": {
    "total_earned": 15750,
    "total_redeemed": 8200,
    "current_balance": 7550,
    "pending_points": 1200
  },
  "redemptions": [
    {
      "id": 301,
      "item_name": "Gift Card Amazon $100",
      "points_cost": 5000,
      "redemption_date": "2024-11-15",
      "status": "delivered"
    }
  ],
  "credits": {
    "available_credit": 2500,
    "used_credit": 1500,
    "credit_limit": 4000
  }
}
```
</ResponseExample>

<ResponseExample>
```json Error - Not Found
{
  "success": false,
  "error": "CollaboratorNotFoundException",
  "message": "Colaborador no encontrado",
  "details": {
    "employee_number": "EMP123456",
    "search_criteria": {
      "active_only": true,
      "include_inactive": false
    }
  },
  "code": 404
}
```
</ResponseExample>

<Warning>
This endpoint may take longer to respond due to complex data aggregation across multiple tables.
</Warning>

---

# Dashboard Controller

## Get Budget Information

Retrieve budget and financial information for dashboard display.

<RequestExample>
```bash cURL
curl -X GET '/api/v2/support/dashboard/budget' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  -H 'Content-Type: application/json'
```
</RequestExample>

<ResponseExample>
```json Success
{
  "success": true,
  "budget_info": {
    "period": "2024-12",
    "total_budget": 2500000,
    "allocated_budget": 1875000,
    "remaining_budget": 625000,
    "utilization_percentage": 75.0,
    "deposit": 500000,
    "debt": 125000,
    "payment": 350000,
    "total_points_earned": 45000,
    "current_balance": 375000,
    "breakdown": {
      "goals": 1200000,
      "boosters": 300000,
      "mechanics": 375000,
      "special_programs": 0
    },
    "projections": {
      "estimated_month_end": 2100000,
      "projected_utilization": 84.0
    }
  },
  "last_updated": "2024-12-15T14:30:00+00:00"
}
```
</ResponseExample>

<Info>
Budget information is calculated from multiple sources including goals, boosters, mechanic rules, and special programs. Data is updated in real-time.
</Info>

---

# Goals Controller

## Upload Goals File

Upload and process goals data from Excel files with comprehensive validation and error handling.

<RequestExample>
```bash cURL
curl -X POST '/api/v2/support/goals/upload' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  -H 'Content-Type: multipart/form-data' \
  -F 'file=@goals_december_2024.xlsx' \
  -F 'period=2024-12' \
  -F 'validate_dates=true'
```
</RequestExample>

<ParamField body="file" type="file" required>
Excel file (.xlsx) containing goals data with columns: employee_number, kpi_id, target_amount, period
</ParamField>

<ParamField body="period" type="string" required>
Target period in YYYY-MM format (e.g., "2024-12")
</ParamField>

<ParamField body="validate_dates" type="boolean">
Whether to validate platform opening dates (default: true)
</ParamField>

<ResponseExample>
```json Success
{
  "success": true,
  "message": "Archivo de metas procesado exitosamente",
  "processing_summary": {
    "total_rows": 850,
    "processed_rows": 847,
    "failed_rows": 3,
    "created_goals": 623,
    "updated_goals": 224,
    "skipped_rows": 3
  },
  "period_info": {
    "period": "2024-12",
    "platform_status": "open",
    "opening_date": "2024-12-01T00:00:00+00:00",
    "closing_date": "2024-12-31T23:59:59+00:00"
  },
  "failed_records": [
    {
      "row": 15,
      "employee_number": "EMP999999",
      "error": "Empleado no encontrado en el sistema",
      "kpi_id": 5
    },
    {
      "row": 23,
      "employee_number": "EMP888888",
      "error": "KPI no válido para el área del empleado",
      "kpi_id": 12
    }
  ]
}
```
</ResponseExample>

<ResponseExample>
```json Error - Date Validation
{
  "success": false,
  "error": "PlatformDateException",
  "message": "La plataforma no está abierta para el período especificado",
  "details": {
    "requested_period": "2024-12",
    "platform_status": "closed",
    "opening_date": "2024-12-01T00:00:00+00:00",
    "closing_date": "2024-11-25T23:59:59+00:00",
    "current_date": "2024-12-15T14:30:00+00:00"
  },
  "code": 403
}
```
</ResponseExample>

<ResponseExample>
```json Error - File Processing
{
  "success": false,
  "error": "FileProcessingException",
  "message": "Error al procesar el archivo cargado",
  "details": {
    "file_name": "goals_december_2024.xlsx",
    "file_size": "2.5MB",
    "processing_errors": [
      {
        "row": 15,
        "column": "employee_number",
        "message": "Número de empleado no encontrado en el sistema",
        "value": "EMP999999"
      },
      {
        "row": 23,
        "column": "goal_amount",
        "message": "El monto de la meta debe ser un número positivo",
        "value": "-1500"
      }
    ],
    "total_rows": 150,
    "processed_rows": 148,
    "failed_rows": 2
  },
  "code": 400
}
```
</ResponseExample>

<Warning>
Platform opening dates are validated by default. Goals can only be uploaded when the platform is open for the specified period.
</Warning>

<Tip>
For large files, consider uploading during off-peak hours to avoid concurrent processing conflicts.
</Tip>

<Info>
The system supports Excel files with multiple sheets. Goals data should be in the first sheet or a sheet named "Goals". File structure requirements: employee_number, kpi_id, target_amount, period columns are mandatory.
</Info>

---

# Headcount Controller

## Get DRVs List

Retrieve list of available DRVs (Regional Sales Divisions) for headcount management.

<RequestExample>
```bash cURL
curl -X GET '/api/v2/support/headcount/drvs' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  -H 'Content-Type: application/json'
```
</RequestExample>

<ResponseExample>
```json Success
{
  "success": true,
  "drvs": [
    {
      "id": 1,
      "name": "DRV_NORTE_01",
      "description": "División Regional Norte 1",
      "status": "active",
      "uen_count": 15,
      "employee_count": 245
    },
    {
      "id": 2,
      "name": "DRV_CENTRO_01",
      "description": "División Regional Centro 1",
      "status": "active",
      "uen_count": 12,
      "employee_count": 189
    },
    {
      "id": 3,
      "name": "DRV_SUR_01",
      "description": "División Regional Sur 1",
      "status": "active",
      "uen_count": 18,
      "employee_count": 312
    }
  ],
  "total_count": 3
}
```
</ResponseExample>

## Get UENs List

Retrieve list of available UENs (Strategic Business Units) for headcount management.

<RequestExample>
```bash cURL
curl -X GET '/api/v2/support/headcount/uens?drv_id=1' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  -H 'Content-Type: application/json'
```
</RequestExample>

<ParamField query="drv_id" type="integer">
Filter UENs by specific DRV ID
</ParamField>

<ResponseExample>
```json Success
{
  "success": true,
  "uens": [
    {
      "id": 101,
      "name": "UEN Norte 1",
      "drv_id": 1,
      "drv_name": "DRV_NORTE_01",
      "status": "active",
      "employee_count": 45
    },
    {
      "id": 102,
      "name": "UEN Norte 2",
      "drv_id": 1,
      "drv_name": "DRV_NORTE_01",
      "status": "active",
      "employee_count": 38
    },
    {
      "id": 103,
      "name": "UEN Norte 3",
      "drv_id": 1,
      "drv_name": "DRV_NORTE_01",
      "status": "active",
      "employee_count": 52
    }
  ],
  "total_count": 3
}
```
</ResponseExample>

## Save Headcount Grid

Process and save headcount data with comprehensive validation and period resolution.

<RequestExample>
```bash cURL
curl -X POST '/api/v2/support/headcount/save_grid' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  -H 'Content-Type: application/json' \
  -d '{
    "period": "2024-12",
    "employees": [
      {
        "employee_number": "EMP123456",
        "full_name": "Juan Carlos Pérez",
        "area": "Ventas",
        "position": "Ejecutivo Senior",
        "drv": "DRV_NORTE_01",
        "uen": "UEN Norte 1",
        "hire_date": "2022-03-15",
        "status": "active",
        "salary": 45000,
        "commission_eligible": true
      },
      {
        "employee_number": "EMP789012",
        "full_name": "María Elena González",
        "area": "Marketing",
        "position": "Coordinadora",
        "drv": "DRV_CENTRO_01",
        "uen": "UEN Centro 2",
        "hire_date": "2021-08-20",
        "status": "active",
        "salary": 38000,
        "commission_eligible": false
      },
      {
        "employee_number": "EMP345678",
        "full_name": "Roberto Silva Martínez",
        "area": "Operaciones",
        "position": "Supervisor",
        "drv": "DRV_SUR_01",
        "uen": "UEN Sur 3",
        "hire_date": "2023-01-10",
        "status": "active",
        "salary": 42000,
        "commission_eligible": true
      }
    ]
  }'
```
</RequestExample>

<ParamField body="period" type="string" required>
Target period in YYYY-MM format for headcount data
</ParamField>

<ParamField body="employees" type="array" required>
Array of employee records with complete headcount information

<Expandable title="Employee Record Structure">
  <ParamField body="employee_number" type="string" required>
  Unique employee identifier in the system
  </ParamField>
  
  <ParamField body="full_name" type="string" required>
  Complete employee name
  </ParamField>
  
  <ParamField body="area" type="string" required>
  Business area or department name
  </ParamField>
  
  <ParamField body="position" type="string" required>
  Job position or role title
  </ParamField>
  
  <ParamField body="drv" type="string" required>
  Regional Sales Division identifier
  </ParamField>
  
  <ParamField body="uen" type="string" required>
  Strategic Business Unit identifier
  </ParamField>
  
  <ParamField body="hire_date" type="string" required>
  Employee hire date in YYYY-MM-DD format
  </ParamField>
  
  <ParamField body="status" type="string" required>
  Employee status (active, inactive, terminated)
  </ParamField>
  
  <ParamField body="salary" type="number">
  Base salary amount
  </ParamField>
  
  <ParamField body="commission_eligible" type="boolean">
  Whether employee is eligible for commission programs
  </ParamField>
</Expandable>
</ParamField>

<ResponseExample>
```json Success
{
  "success": true,
  "message": "Datos de headcount procesados exitosamente",
  "processing_summary": {
    "total_employees": 3,
    "processed_employees": 3,
    "failed_employees": 0,
    "new_records": 1,
    "updated_records": 2
  },
  "period_info": {
    "resolved_period": "2024-12",
    "period_id": 156,
    "status": "active"
  },
  "processed_records": [
    {
      "employee_number": "EMP123456",
      "action": "updated",
      "changes": ["salary", "position"]
    },
    {
      "employee_number": "EMP789012",
      "action": "updated",
      "changes": ["uen"]
    },
    {
      "employee_number": "EMP345678",
      "action": "created",
      "changes": []
    }
  ]
}
```
</ResponseExample>

<ResponseExample>
```json Error - Partial Success
{
  "success": false,
  "message": "Procesamiento completado con errores",
  "processing_summary": {
    "total_employees": 3,
    "processed_employees": 2,
    "failed_employees": 1
  },
  "processed_records": [
    {
      "employee_number": "EMP123456",
      "action": "updated",
      "status": "success"
    },
    {
      "employee_number": "EMP789012",
      "action": "created",
      "status": "success"
    }
  ],
  "failed_records": [
    {
      "employee_number": "EMP345678",
      "error": "DRV no válido: DRV_INVALID_01",
      "details": "El DRV especificado no existe en el sistema"
    }
  ]
}
```
</ResponseExample>

<Info>
The system automatically resolves periods and validates area/position combinations against the organizational structure. Employee records are matched by employee_number for updates or created as new records.
</Info>

---

# Mechanic Controller

## Get Areas List

Retrieve list of business areas for mechanic configuration.

<RequestExample>
```bash cURL
curl -X GET '/api/v2/support/mechanic/areas' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  -H 'Content-Type: application/json'
```
</RequestExample>

<ResponseExample>
```json Success
{
  "success": true,
  "areas": [
    {
      "id": 1,
      "name": "Ventas",
      "description": "Área de Ventas Corporativas",
      "status": "active"
    },
    {
      "id": 2,
      "name": "Marketing",
      "description": "Área de Marketing y Comunicaciones",
      "status": "active"
    },
    {
      "id": 3,
      "name": "Operaciones",
      "description": "Área de Operaciones y Logística",
      "status": "active"
    }
  ]
}
```
</ResponseExample>

## Get Positions List

Retrieve list of job positions for mechanic configuration.

<RequestExample>
```bash cURL
curl -X GET '/api/v2/support/mechanic/positions' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  -H 'Content-Type: application/json'
```
</RequestExample>

<ResponseExample>
```json Success
{
  "success": true,
  "positions": [
    {
      "id": 1,
      "name": "Ejecutivo Junior",
      "description": "Ejecutivo de Ventas Nivel Junior",
      "status": "active"
    },
    {
      "id": 2,
      "name": "Ejecutivo Senior",
      "description": "Ejecutivo de Ventas Nivel Senior",
      "status": "active"
    },
    {
      "id": 3,
      "name": "Coordinador",
      "description": "Coordinador de Área",
      "status": "active"
    }
  ]
}
```
</ResponseExample>

## Get KPIs List

Retrieve list of available KPIs for mechanic rules.

<RequestExample>
```bash cURL
curl -X GET '/api/v2/support/mechanic/kpis' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  -H 'Content-Type: application/json'
```
</RequestExample>

<ResponseExample>
```json Success
{
  "success": true,
  "kpis": [
    {
      "id": 1,
      "name": "Ventas Mensuales",
      "description": "Meta de ventas mensuales en pesos",
      "unit": "MXN",
      "status": "active"
    },
    {
      "id": 2,
      "name": "Satisfacción Cliente",
      "description": "Índice de satisfacción del cliente",
      "unit": "score",
      "status": "active"
    },
    {
      "id": 3,
      "name": "Eficiencia Operacional",
      "description": "Porcentaje de eficiencia en procesos",
      "unit": "percentage",
      "status": "active"
    }
  ]
}
```
</ResponseExample>

## Get Award Types

Retrieve list of available award types for mechanic rules.

<RequestExample>
```bash cURL
curl -X GET '/api/v2/support/mechanic/award_types' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  -H 'Content-Type: application/json'
```
</RequestExample>

<ResponseExample>
```json Success
{
  "success": true,
  "award_types": [
    {
      "id": 1,
      "name": "Puntos",
      "description": "Recompensa en puntos canjeables",
      "status": "active"
    },
    {
      "id": 2,
      "name": "Efectivo",
      "description": "Recompensa monetaria directa",
      "status": "active"
    },
    {
      "id": 3,
      "name": "Mixto",
      "description": "Combinación de puntos y efectivo",
      "status": "active"
    }
  ]
}
```
</ResponseExample>

## Save Mechanic Grid

Create and update complex incentive rules with comprehensive validation and conflict detection.

<RequestExample>
```bash cURL
curl -X POST '/api/v2/support/mechanic/save_grid' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  -H 'Content-Type: application/json' \
  -d '{
    "year": 2024,
    "month": 12,
    "payload": [
      {
        "area_id": 1,
        "position_id": 5,
        "kpi_id": 3,
        "award_type_id": 1,
        "rule_type": "percentage",
        "min_value": 80.0,
        "max_value": 120.0,
        "award_amount": 1500,
        "multiplier": 1.2,
        "is_active": true,
        "description": "Incentivo por cumplimiento de ventas mensuales",
        "conditions": {
          "min_months_active": 3,
          "exclude_probation": true,
          "drv_restriction": ["Norte", "Centro"]
        }
      },
      {
        "area_id": 2,
        "position_id": 8,
        "kpi_id": 7,
        "award_type_id": 2,
        "rule_type": "fixed",
        "min_value": 100.0,
        "max_value": null,
        "award_amount": 2000,
        "multiplier": 1.0,
        "is_active": true,
        "description": "Bono fijo por cumplimiento de KPI de satisfacción",
        "conditions": {
          "min_months_active": 6,
          "exclude_probation": false,
          "uen_restriction": ["UEN Norte 1", "UEN Centro 2"]
        }
      },
      {
        "area_id": 3,
        "position_id": 12,
        "kpi_id": 15,
        "award_type_id": 3,
        "rule_type": "tiered",
        "tiers": [
          {
            "min_value": 90.0,
            "max_value": 99.9,
            "award_amount": 800,
            "multiplier": 1.0
          },
          {
            "min_value": 100.0,
            "max_value": 109.9,
            "award_amount": 1200,
            "multiplier": 1.1
          },
          {
            "min_value": 110.0,
            "max_value": null,
            "award_amount": 1800,
            "multiplier": 1.3
          }
        ],
        "is_active": true,
        "description": "Sistema escalonado para KPI de eficiencia operacional"
      }
    ]
  }'
```
</RequestExample>

<ParamField body="year" type="integer" required>
Year for the mechanic grid period (e.g., 2024)
</ParamField>

<ParamField body="month" type="integer" required>
Month for the mechanic grid period (1-12)
</ParamField>

<ParamField body="payload" type="array" required>
Array of mechanic configuration records defining incentive rules

<Expandable title="Mechanic Rule Structure">
  <ParamField body="area_id" type="integer" required>
  ID of the business area from areas_new table
  </ParamField>
  
  <ParamField body="position_id" type="integer" required>
  ID of the position from positions_new table
  </ParamField>
  
  <ParamField body="kpi_id" type="integer" required>
  ID of the KPI from kpis_new table
  </ParamField>
  
  <ParamField body="award_type_id" type="integer" required>
  ID of the award type from award_types_new table (1=Points, 2=Cash, 3=Mixed)
  </ParamField>
  
  <ParamField body="rule_type" type="string" required>
  Type of rule logic ("percentage", "fixed", "tiered", "progressive")
  </ParamField>
  
  <ParamField body="min_value" type="number">
  Minimum threshold value for rule activation
  </ParamField>
  
  <ParamField body="max_value" type="number">
  Maximum threshold value (null for unlimited)
  </ParamField>
  
  <ParamField body="award_amount" type="number">
  Base award amount (points or currency)
  </ParamField>
  
  <ParamField body="multiplier" type="number">
  Performance multiplier factor (default: 1.0)
  </ParamField>
  
  <ParamField body="is_active" type="boolean">
  Whether the rule is currently active
  </ParamField>
  
  <ParamField body="description" type="string">
  Human-readable description of the incentive rule
  </ParamField>
  
  <ParamField body="conditions" type="object">
  Additional conditions and restrictions for rule application
  </ParamField>
  
  <ParamField body="tiers" type="array">
  For tiered rules: array of tier definitions with min/max values and awards
  </ParamField>
</Expandable>
</ParamField>

<ResponseExample>
```json Success
{
  "success": true,
  "period": {
    "id": 156,
    "year": "2024",
    "month": "12",
    "created": "2024-12-15T14:30:00+00:00"
  },
  "processing_summary": {
    "total_rules": 3,
    "created": 2,
    "updated": 1,
    "failed": 0,
    "deactivated": 0
  },
  "created_rules": [
    {
      "id": 1001,
      "area_name": "Ventas",
      "position_name": "Ejecutivo Senior",
      "kpi_name": "Ventas Mensuales",
      "award_type": "Puntos",
      "rule_type": "percentage"
    },
    {
      "id": 1002,
      "area_name": "Servicio al Cliente", 
      "position_name": "Coordinador",
      "kpi_name": "Satisfacción Cliente",
      "award_type": "Efectivo",
      "rule_type": "fixed"
    }
  ],
  "updated_rules": [
    {
      "id": 998,
      "area_name": "Operaciones",
      "position_name": "Supervisor",
      "kpi_name": "Eficiencia Operacional",
      "changes": ["award_amount", "multiplier", "tiers"]
    }
  ],
  "history_records": [
    {
      "id": 2001,
      "mechanic_grid_id": 1001,
      "action": "created",
      "timestamp": "2024-12-15T14:30:15+00:00"
    }
  ]
}
```
</ResponseExample>

<ResponseExample>
```json Error - Validation Failed
{
  "success": false,
  "error": "ValidationException",
  "message": "Errores de validación en las reglas de mecánica",
  "validation_errors": [
    {
      "rule_index": 0,
      "field": "area_id",
      "message": "El área con ID 99 no existe en el sistema",
      "value": 99
    },
    {
      "rule_index": 1,
      "field": "min_value",
      "message": "El valor mínimo debe ser menor que el valor máximo",
      "min_value": 120.0,
      "max_value": 100.0
    },
    {
      "rule_index": 2,
      "field": "tiers",
      "message": "Las reglas escalonadas requieren al menos 2 niveles",
      "provided_tiers": 1
    }
  ],
  "total_errors": 3
}
```
</ResponseExample>

<ResponseExample>
```json Error - Rule Conflict
{
  "success": false,
  "error": "RuleConflictException",
  "message": "Conflicto detectado entre reglas de mecánica",
  "conflicts": [
    {
      "rule_1": {
        "id": 1001,
        "area": "Ventas",
        "position": "Ejecutivo",
        "kpi": "Ventas Mensuales"
      },
      "rule_2": {
        "id": 1005,
        "area": "Ventas", 
        "position": "Ejecutivo",
        "kpi": "Ventas Mensuales"
      },
      "conflict_type": "overlapping_criteria",
      "message": "Múltiples reglas activas para la misma combinación área/posición/KPI"
    }
  ],
  "code": 409
}
```
</ResponseExample>

<Info>
The mechanic grid system supports complex incentive rules with multiple award types, tiered structures, and conditional logic. Historical records are automatically maintained for audit purposes.
</Info>

<Warning>
Mechanic rules are applied in real-time to performance calculations. Ensure thorough testing before activating rules in production periods.
</Warning>

---

# Reports Controller

## Download Log Files

Download system log files for debugging and monitoring purposes.

<RequestExample>
```bash cURL
curl -X GET '/api/v2/support/reports/downloadLog?file=system.log' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  --output system.log
```
</RequestExample>

<ParamField query="file" type="string" required>
Name of the log file to download
</ParamField>

<ResponseExample>
```json Success
{
  "success": true,
  "file_info": {
    "filename": "system.log",
    "size": "2.5MB",
    "last_modified": "2024-12-15T14:30:00+00:00",
    "download_url": "/tmp/downloads/system_20241215_143000.log"
  }
}
```
</ResponseExample>

## Generate Headcount Report

Generate and download comprehensive headcount reports in Excel format.

<RequestExample>
```bash cURL
curl -X GET '/api/v2/support/reports/downloadHeadcount?period=2024-12&format=xlsx' \
  -H 'Authorization: Bearer YOUR_TOKEN' \
  --output headcount_report_2024-12.xlsx
```
</RequestExample>

<ParamField query="period" type="string" required>
Period for the report in YYYY-MM format
</ParamField>

<ParamField query="format" type="string">
Report format (xlsx, csv). Default: xlsx
</ParamField>

<ParamField query="drv" type="string">
Filter by specific DRV
</ParamField>

<ParamField query="uen" type="string">
Filter by specific UEN
</ParamField>

<ResponseExample>
```json Success
{
  "success": true,
  "report_info": {
    "filename": "headcount_report_2024-12.xlsx",
    "period": "2024-12",
    "total_records": 1250,
    "generation_time": "2024-12-15T14:30:00+00:00",
    "file_size": "1.8MB",
    "download_url": "/tmp/reports/headcount_2024-12_20241215_143000.xlsx"
  },
  "summary": {
    "total_employees": 1250,
    "active_employees": 1180,
    "inactive_employees": 70,
    "by_drv": {
      "DRV_NORTE_01": 420,
      "DRV_CENTRO_01": 380,
      "DRV_SUR_01": 450
    }
  }
}
```
</ResponseExample>

<ResponseExample>
```json Error - Report Generation
{
  "success": false,
  "error": "ReportGenerationException",
  "message": "Error al generar el reporte solicitado",
  "details": {
    "report_type": "headcount_summary",
    "parameters": {
      "period": "2024-12",
      "drv": "DRV_NORTE"
    },
    "error_details": "Datos insuficientes para el período especificado",
    "data_availability": {
      "total_records": 0,
      "expected_minimum": 1
    }
  },
  "code": 400
}
```
</ResponseExample>

---

# Error Handling

The Support Module API uses standard HTTP status codes and provides detailed error responses to help developers understand and resolve issues.

## Common Error Responses

<ResponseExample>
```json Authentication Error (401)
{
  "success": false,
  "error": "UnauthorizedException",
  "message": "Token de autenticación inválido o expirado",
  "code": 401,
  "timestamp": "2024-12-15T14:30:00+00:00"
}
```
</ResponseExample>

<ResponseExample>
```json Validation Error (422)
{
  "success": false,
  "error": "ValidationException", 
  "message": "Los datos proporcionados no son válidos",
  "validation_errors": [
    {
      "field": "employee_number",
      "message": "El número de empleado es requerido",
      "code": "required"
    },
    {
      "field": "period",
      "message": "El período debe estar en formato YYYY-MM",
      "code": "invalid_format",
      "provided_value": "2024/12"
    }
  ],
  "code": 422
}
```
</ResponseExample>

<ResponseExample>
```json Database Error (500)
{
  "success": false,
  "error": "DatabaseException",
  "message": "Error interno del servidor al procesar la solicitud",
  "error_id": "ERR_DB_2024121514300001",
  "code": 500,
  "timestamp": "2024-12-15T14:30:00+00:00"
}
```
</ResponseExample>

<ResponseExample>
```json Rate Limit Error (429)
{
  "success": false,
  "error": "RateLimitException",
  "message": "Límite de solicitudes excedido",
  "details": {
    "limit": 100,
    "remaining": 0,
    "reset_time": "2024-12-15T15:00:00+00:00",
    "retry_after": 1800
  },
  "code": 429
}
```
</ResponseExample>

<Info>
Error responses include detailed information to help developers identify and resolve issues quickly. Always check the `error` field for the specific exception type and `validation_errors` for field-level issues.
</Info>

<Warning>
Database errors (500) are logged automatically. If you encounter persistent 500 errors, contact the system administrator with the provided `error_id`.
</Warning>

---

# Rate Limiting

The Support Module API implements rate limiting to ensure fair usage and system stability.

- **Standard endpoints**: 100 requests per minute per API key
- **File upload endpoints**: 10 requests per minute per API key
- **Report generation**: 5 requests per minute per API key

<Tip>
Monitor the `X-RateLimit-Remaining` header in responses to track your current rate limit status.
</Tip>

---

# Best Practices

<Steps>
<Step title="Authentication">
  Always include the Authorization header with a valid Bearer token for all requests.
  
  <Check>
  Verify token validity before making batch operations.
  </Check>
</Step>

<Step title="File Validation">
  Validate file formats and sizes on the client side before uploading to reduce server load.
  
  <Check>
  Only .xlsx files are accepted for uploads.
  </Check>
</Step>

<Step title="Error Handling">
  Implement comprehensive error handling for all possible HTTP status codes and validation errors.
</Step>

<Step title="Pagination">
  Use appropriate page sizes for list endpoints to optimize performance and user experience.
</Step>
</Steps>