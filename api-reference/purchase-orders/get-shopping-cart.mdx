---
title: "Get Shopping Cart"
api: "GET /api/v2/collaborator/purchase-orders/cart"
description: "Retrieve the current user's shopping cart contents"
---

This endpoint retrieves all items currently in the authenticated user's shopping cart, including product details, quantities, and point values. The implementation uses the UserShoppingCartItem service to format and return cart data.

## Authentication

<ParamField header="Authorization" type="string" required>
Bearer token for API authentication. Format: `Bearer YOUR_API_KEY`
</ParamField>

## Implementation Details

The endpoint performs the following operations:

<Steps>
<Step title="User Authentication">
Validates that the user is authenticated and retrieves their user ID.
</Step>

<Step title="Cart Retrieval">
Uses UserShoppingCartItem service to get formatted cart data with product information.
</Step>

<Step title="Product Validation">
Validates that all products in the cart are still active and available.
</Step>

<Step title="Points Calculation">
Calculates total points required for all items in the cart.
</Step>
</Steps>

## Response Structure

The response includes detailed information about each cart item:

<ResponseField name="success" type="boolean" required>
Indicates if the request was successful.
</ResponseField>

<ResponseField name="data" type="object" required>
Container for cart data.

<Expandable title="Cart data structure">
<ResponseField name="cart" type="array" required>
Array of cart items with product details.

<Expandable title="Cart item structure">
<ResponseField name="id" type="integer">
Product unique identifier.
</ResponseField>

<ResponseField name="name" type="string">
Product name.
</ResponseField>

<ResponseField name="sku" type="string">
Product SKU code.
</ResponseField>

<ResponseField name="quantity" type="integer">
Quantity of this product in the cart.
</ResponseField>

<ResponseField name="points" type="integer">
Points required per unit.
</ResponseField>

<ResponseField name="total_points" type="integer">
Total points for this item (quantity × points).
</ResponseField>

<ResponseField name="stock" type="string">
Available stock for this product.
</ResponseField>

<ResponseField name="description" type="object">
Product descriptions in different formats.

<Expandable title="Description formats">
<ResponseField name="large" type="string">
Full product description.
</ResponseField>

<ResponseField name="medium" type="string">
Medium-length description.
</ResponseField>

<ResponseField name="short" type="string">
Short description.
</ResponseField>
</Expandable>
</ResponseField>

<ResponseField name="image_url" type="string">
URL to product image.
</ResponseField>
</Expandable>
</ResponseField>

<ResponseField name="cever" type="boolean">
Indicates if cart contains CEVER products requiring special documentation.
</ResponseField>

<ResponseField name="total_items" type="integer">
Total number of items in cart.
</ResponseField>

<ResponseField name="total_points" type="integer">
Total points required for entire cart.
</ResponseField>
</Expandable>
</ResponseField>

## Response Examples

<ResponseExample>
```json Success Response - Cart with Items
{
  "success": true,
  "data": {
    "cart": [
      {
        "id": 123,
        "name": "Producto Ejemplo",
        "sku": "PROD-123",
        "quantity": 2,
        "points": 250,
        "total_points": 500,
        "stock": "10",
        "description": {
          "large": "Descripción completa del producto ejemplo",
          "medium": "Descripción completa del producto ejemplo",
          "short": "Descripción completa del producto ejemplo"
        },
        "image_url": "https://example.com/images/product-123.jpg"
      },
      {
        "id": 456,
        "name": "CEVER Product",
        "sku": "CEVER",
        "quantity": 1,
        "points": 1000,
        "total_points": 1000,
        "stock": "5",
        "description": {
          "large": "Producto CEVER que requiere documentación especial",
          "medium": "Producto CEVER que requiere documentación especial",
          "short": "Producto CEVER que requiere documentación especial"
        },
        "image_url": "https://example.com/images/cever-456.jpg"
      }
    ],
    "cever": true,
    "total_items": 3,
    "total_points": 1500
  }
}
```
</ResponseExample>

<ResponseExample>
```json Success Response - Empty Cart
{
  "success": true,
  "data": {
    "cart": [],
    "cever": false,
    "total_items": 0,
    "total_points": 0
  }
}
```
</ResponseExample>

<ResponseExample>
```json Error Response - Authentication Failed
{
  "success": false,
  "message": "Usuario no autenticado",
  "errors": {
    "auth": "Token de autorización requerido"
  }
}
```
</ResponseExample>

## Code Implementation

<CodeGroup>
```php PHP Controller
// From PurchaseOrdersController.php
public function getCart() {
    // Get authenticated user
    $user = $this->getUser();
    
    // Get formatted cart data
    $cartService = new UserShoppingCartItem();
    $shoppingCart = $this->getShoppingCart($user->id);
    
    $cartData = $cartService->getFormatted($shoppingCart, true);
    
    // Calculate totals
    $totalItems = array_sum(array_column($cartData['cart'], 'quantity'));
    $totalPoints = array_sum(array_column($cartData['cart'], 'total_points'));
    
    return $this->response->withType('application/json')
        ->withStringBody(json_encode([
            'success' => true,
            'data' => array_merge($cartData, [
                'total_items' => $totalItems,
                'total_points' => $totalPoints
            ])
        ]));
}
```

```javascript JavaScript/Fetch
const response = await fetch('/api/v2/collaborator/purchase-orders/cart', {
  method: 'GET',
  headers: {
    'Authorization': 'Bearer YOUR_API_KEY'
  }
});

const cartData = await response.json();

if (cartData.success) {
  console.log('Cart items:', cartData.data.cart);
  console.log('Total points needed:', cartData.data.total_points);
  console.log('Contains CEVER products:', cartData.data.cever);
}
```

```curl cURL
curl -X GET '/api/v2/collaborator/purchase-orders/cart' \
  -H 'Authorization: Bearer YOUR_API_KEY'
```
</CodeGroup>

## Special Considerations

<Info>
The `cever` flag in the response indicates whether the cart contains products that require special documentation (RFC, INE, proof of address) during checkout.
</Info>

<Tip>
Use the `stock` field to validate product availability before allowing users to proceed to checkout.
</Tip>

<Warning>
Product prices and availability are validated in real-time. Cart contents may change between viewing and purchasing if products become unavailable.
</Warning>

## Related Endpoints

- [Add to Cart](/api-reference/purchase-orders/add-to-cart) - Add products to the shopping cart
- [Remove from Cart](/api-reference/purchase-orders/remove-from-cart) - Remove products from the cart
- [Purchase Cart](/api-reference/purchase-orders/purchase-cart) - Complete the cart purchase

```json Cart with Unavailable Items (200 OK)
{
  "success": true,
  "data": {
    "cart_id": "cart_abc123",
    "items": [
      {
        "cart_item_id": "item_003",
        "product_id": "prod_99999",
        "product_name": "Tablet iPad Pro",
        "product_image": "https://cdn.example.com/products/ipad-pro.jpg",
        "quantity": 1,
        "unit_points": 1200,
        "total_points": 1200,
        "availability": {
          "in_stock": false,
          "available_quantity": 0,
          "reason": "out_of_stock"
        },
        "added_at": "2024-01-14T15:30:00Z"
      }
    ],
    "summary": {
      "total_items": 1,
      "total_quantity": 1,
      "total_points": 1200,
      "estimated_delivery": null
    },
    "collaborator_balance": {
      "available_points": 2500,
      "sufficient_balance": true
    },
    "warnings": [
      {
        "type": "product_unavailable",
        "message": "Algunos productos en tu carrito no están disponibles",
        "affected_items": ["item_003"]
      }
    ],
    "updated_at": "2024-01-15T10:15:00Z"
  }
}
```
</ResponseExample>

## Response Fields

<ResponseField name="cart_id" type="string">
  Unique identifier for the shopping cart session
</ResponseField>

<ResponseField name="items" type="array">
  Array of products currently in the shopping cart
  
  <Expandable title="Cart Item Properties">
    <ResponseField name="cart_item_id" type="string">
      Unique identifier for this specific cart item
    </ResponseField>
    
    <ResponseField name="product_id" type="string">
      Product identifier from the catalog
    </ResponseField>
    
    <ResponseField name="product_name" type="string">
      Display name of the product
    </ResponseField>
    
    <ResponseField name="product_image" type="string">
      URL to the product's main image
    </ResponseField>
    
    <ResponseField name="quantity" type="integer">
      Number of units in cart for this product
    </ResponseField>
    
    <ResponseField name="unit_points" type="integer">
      Points cost per individual unit
    </ResponseField>
    
    <ResponseField name="total_points" type="integer">
      Total points for this cart item (unit_points × quantity)
    </ResponseField>
    
    <ResponseField name="availability" type="object">
      Current availability status for this product
      
      <Expandable title="Availability Properties">
        <ResponseField name="in_stock" type="boolean">
          Whether the product is currently available
        </ResponseField>
        
        <ResponseField name="available_quantity" type="integer">
          Number of units available in inventory
        </ResponseField>
        
        <ResponseField name="reason" type="string">
          Reason for unavailability (if applicable): `out_of_stock`, `discontinued`, `region_restricted`
        </ResponseField>
      </Expandable>
    </ResponseField>
    
    <ResponseField name="added_at" type="string">
      ISO 8601 timestamp when item was added to cart
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="summary" type="object">
  Cart totals and summary information
  
  <Expandable title="Summary Properties">
    <ResponseField name="total_items" type="integer">
      Number of different products in cart
    </ResponseField>
    
    <ResponseField name="total_quantity" type="integer">
      Total number of individual units across all products
    </ResponseField>
    
    <ResponseField name="total_points" type="integer">
      Total points required for all items in cart
    </ResponseField>
    
    <ResponseField name="estimated_delivery" type="string | null">
      ISO 8601 estimated delivery date, null if cart is empty or has unavailable items
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="collaborator_balance" type="object">
  Collaborator's current point balance and purchase capability
  
  <Expandable title="Balance Properties">
    <ResponseField name="available_points" type="integer">
      Current available points for the collaborator
    </ResponseField>
    
    <ResponseField name="sufficient_balance" type="boolean">
      Whether collaborator has enough points for current cart total
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="warnings" type="array">
  Array of warnings about cart contents (optional)
  
  <Expandable title="Warning Properties">
    <ResponseField name="type" type="string">
      Warning type: `product_unavailable`, `insufficient_stock`, `price_changed`
    </ResponseField>
    
    <ResponseField name="message" type="string">
      Human-readable warning message
    </ResponseField>
    
    <ResponseField name="affected_items" type="array">
      Array of cart_item_ids affected by this warning
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="updated_at" type="string">
  ISO 8601 timestamp of last cart modification
</ResponseField>

## Cart States

<AccordionGroup>
  <Accordion title="Empty Cart">
    When no items have been added to the cart:
    - `items` array is empty
    - `total_points` is 0
    - `estimated_delivery` is null
  </Accordion>
  
  <Accordion title="Active Cart">
    Cart with available products:
    - All items show `in_stock: true`
    - `sufficient_balance` indicates if purchase is possible
    - `estimated_delivery` shows expected delivery date
  </Accordion>
  
  <Accordion title="Cart with Issues">
    Cart containing unavailable products or other issues:
    - Items may show `in_stock: false`
    - `warnings` array contains relevant alerts
    - `estimated_delivery` may be null
  </Accordion>
</AccordionGroup>

## Best Practices

<Tip>
**Real-time Updates**: Cart contents and availability are checked in real-time. Product availability can change between cart views.
</Tip>

<Note>
**Automatic Cleanup**: Items that become permanently unavailable are automatically removed from carts after 7 days.
</Note>

<Warning>
**Session Management**: Shopping carts are persistent but may expire after 30 days of inactivity.
</Warning>

## Common Use Cases

<CardGroup cols={2}>
  <Card title="Cart Review" icon="eye">
    Display current cart contents before checkout
  </Card>
  <Card title="Availability Check" icon="check-circle">
    Verify all items are still available before purchase
  </Card>
  <Card title="Point Calculation" icon="calculator">
    Show total points required and remaining balance
  </Card>
  <Card title="Cart Validation" icon="shield-check">
    Identify any issues preventing successful checkout
  </Card>
</CardGroup>